<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Letters From the Front</title>
	<meta name="description" content="World War One Interactive Timeline">
	<link rel="stylesheet" href="index.css">
	<link href="https://fonts.googleapis.com/css?family=Roboto:100" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Nothing+You+Could+Do" rel="stylesheet">
</head>

<body>
	<div class="modal">
		<div class="modal-content">
			<span class="close-button">&times;</span>
			<div id="modalContainer">
				<div id="modalImage"></div>
				<div id="modalText">
					<div id="modalHeader"></div>
					<div id="modalTranscript"></div>
				</div>
			</div>
		</div>
	</div>

	<div class="intro-modal" id="intro-modal">
		<p id="welcome">W E L C O M E</p>
		<h1 class="intro-h1">Letters From</h1>
		<h1 class="intro-h1"> The Front</h1>
		<!--<h2 class="intro-h2">AN INTERACTIVE HISTORY TIMELINE WEB EXPERIENCE</h2>-->
		<br></br>
		<p class="intro-p"> Our project lets you learn more about the First World War through exploring archival resources held
			by The State Library of Queensland.</p>
		<br></br>
		<div class="intro-container">
			<div class="intro-box">
				<img src="images/stories.png" width="200px" />
				<p class="intro-p">Explore the timeline by clicking on content</p>
			</div>
			<div class="intro-box">
				<img src="images/stories.png" width="200px" />
				<p class="intro-p">Unlock more content by transcribing documents (bonus: this helps make the project more accessible)</p>
			</div>
			<div class="intro-box">
				<img src="images/stories.png" width="200px" />
				<p class="intro-p"> Customise your experience by selecting filter categories that suit your interests</p>
			</div>
			<div class="intro-box">
				<img src="images/stories.png" width="200px" />
				<p class="intro-p"> Upload your own family stories or photographs to help grow our community</p>
			</div>
			<div class="intro-box">
				<img src="images/stories.png" width="200px" />
				<p class="intro-p"> Skip ahead using the scrubber at the bottom </p>
			</div>
		</div>
		<button class="intro-btn" id="intro-btn">E N T E R</button>
	</div>

	<!-- Header -->
	<div id="header" class="header" style="display: none; left: 0%; top: 0%;">
		<div class="top-header">
			<!--
			<a href="#logo"><img src="images/Letters-logo-1.png"></a>-->
			<img src="images/Letters-logo-1.png">
			<ul class="years centered">
				<li class="year" unlocked=true contentNum=2 contentNumUnlocked=1 id="1914"><a>1914</a></li>
				<li class="year" unlocked=false contentNum=2 contentNumUnlocked=0 id="1915"><a>1915</a></li>
				<li class="year" unlocked=false contentNum=0 contentNumUnlocked=0 id="1916"><a>1916</a></li>
				<li class="year" unlocked=false contentNum=0 contentNumUnlocked=0 id="1917"><a>1917</a></li>
				<li class="year" unlocked=false contentNum=0 contentNumUnlocked=0 id="1918"><a>1918</a></li>
			</ul>
			<!--<a href="#account"><img src="images/account.png"></a>-->
			<img src="images/account.png">
		</div>
		<div class="filter-bar">
			<div class="centered">
				<input class="check" id="photos" type="checkbox" name="photos" value="photos" checked="true">
				<label for="photos">Photos</label>
				<input class="check" id="stories" type="checkbox" name="stories" value="stories" checked="true">
				<label for="stories">Stories</label>
				<input class="check" id="events" type="checkbox" name="events" value="events" checked="true">
				<label for="events">Events</label>

				<input class="check" id="letters" type="checkbox" name="letters" value="letters" checked="true">
				<label for="letters">Letters</label>

				<input class="check" id="propaganda" type="checkbox" name="propaganda" value="propaganda" checked="true">
				<label for="propaganda">Propaganda</label>

				<input class="check" id="newspapers" type="checkbox" name="newspapers" value="newspapers" checked="true">
				<label for="newspapers">Newspapers</label>

				<input class="check" id="other" type="checkbox" name="other" value="other" checked="true">
				<label for="other">Community </label>

				<input class="check" id="other" type="checkbox" name="other" value="other" checked="true">
				<label for="other">Other</label>
			</div>
		</div>

	</div>

	<!-- Timeline -->

	<div id="timeline" class="timeline" style="display: none">
		<div class="timeline-texture"> </div>
		<div class="telegram-texture"> </div>
		<div id="title" class="float depth10" style="left: 7%; top: 50%;">
			<a name="home">
				<h1>Letters From The Front.</h1>
			</a>
		</div>

		<div class="float depth20" style="left: 18.5%; top: 55%;">
			<a href="#1914">
				<img src="images/arrow-forward.png">
			</a>
		</div>
		<div class="float depth10" style="left: 18%; top: 53%;"><span id="yearText">1914</span></div>


		<!-- Image Divs -->
		<div id="timelineItems">

		</div>
		<div class="float depth25 telegram" style="left: 27%; top: 100%;">Jun 26th, Archduke Franz Ferdenand assassinated!</div>
		<div class="float depth25 telegram" style="left: 35%; top: 100%;">Aug 4th, German troops invade Poland. </div>
		<div class="float depth25 telegram" style="left: 45%; top: 100%;">Sep 23rd, Allied forces join the Western Front.</div>
	</div>

	<!-- Button -->
	<div id="footer" class="footer" style="display: none">
		<button id="circle-button">+</button>
		<div id="buttons">
			<button id="addStory" class="circle-button-buttons">Story</button>
			<button class="circle-button-buttons">Photo</button>
		</div>
		<!-- Scrubber -->
		<div class="footer" style="left: 2%; top: 85%;" id="scrubber">
			<div class="scrubberCol"> </div>
		</div>
	</div>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<script src="timeline/js/timeline.min.js"></script>
	<script type="text/javascript">
		var buttonsShow = false;
		var modal = $(".modal");
		var mHeader = $("#modalHeader");
		var mData = $("#modalData");
		var mTranscript = $("#modalTranscript");
		var contentYear = "1914";
		var unlockedColNum = 1;

		$("#intro-btn").click(function (e) {
			$("#intro-modal").fadeOut();
			$("#header").fadeIn();
			$("#timeline").fadeIn();
			$("#footer").fadeIn();
		});

		var closeButton = $(".close-button");
		var images = [
			"war.jpg",
			"night.jpg",
			"planes.jpg",
			"trees.jpg",
			"walk.jpg",
			"warbombs.jpg"
		];

		var filters = ['events', 'photos', 'stories', 'letters', 'propaganda', 'newspapers', 'other'];

		var yearStatus = [
			{
				year: 1914,
				unlocked: true,
				contentNum: 2
			},
			{
				year: 1915,
				unlocked: false,
				contentNum: 1
			},
			{
				year: 1916,
				unlocked: false,
				contentNum: 0
			},
			{
				year: 1917,
				unlocked: false,
				contentNum: 0
			},
			{
				year: 1918,
				unlocked: false,
				contentNum: 0
			}
		];

		let content = [
			{
				username: "Dave",
				img: "images/event-dark.jpg",
				type: "events",
				date: "27/01/1914",
				title: "war declared",
				transcript: "Event during the First World War",
				unlocked: true
			},
			{
				username: "carol",
				img: "images/stories.png",
				type: "stories",
				date: "27/09/1914",
				title: "war declared",
				transcript: "Community story from the First World War",
				unlocked: false
			},
			{
				username: "kerry",
				img: "images/photo.png",
				type: "photos",
				date: "27/05/1914",
				title: "war declared",
				transcript: "Photograph of the Auchterlonie brothers of Gympie (1914)",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/letter.png.jpg",
				type: "letters",
				date: "27/06/1914",
				title: "war declared",
				transcript: "Letter from the First World War",
				unlocked: true
			},
			{
				username: "Dave",
				img: "images/propaganda.png",
				type: "propaganda",
				date: "27/08/1914",
				title: "war declared",
				transcript: "Propaganda from the First World War",
				unlocked: true
			},
			{
				username: "carol",
				img: "images/news-dark.jpg",
				type: "newspapers",
				date: "22/08/1914",
				title: "war declared",
				transcript: "Newspaper from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/other-dark.jpg",
				type: "other",
				date: "26/09/1914",
				title: "war declared",
				transcript: "Assorted resources from the First World War",
				unlocked: true
			}, {
				username: "Dave",
				img: "images/event-dark.jpg",
				type: "events",
				date: "27/09/1914",
				title: "war declared",
				transcript: "Event from the First World War",
				unlocked: true
			},
			{
				username: "carol",
				img: "images/stories.png",
				type: "stories",
				date: "28/09/1914",
				title: "war declared",
				transcript: "Story from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/photo.png",
				type: "photos",
				date: "30/09/1914",
				title: "war declared",
				transcript: "Photograph from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/letter.png.jpg",
				type: "letters",
				date: "10/10/1914",
				title: "war declared",
				transcript: "Letter from the First World War",
				unlocked: false
			},
			{
				username: "Dave",
				img: "images/propaganda.png",
				type: "propaganda",
				date: "12/10/1914",
				title: "war declared",
				transcript: "Event during the First World War",
				unlocked: true
			},
			{
				username: "carol",
				img: "images/news-dark.jpg",
				type: "newspapers",
				date: "22/10/1914",
				title: "war declared",
				transcript: "Newspaper from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/other-dark.jpg",
				type: "other",
				date: "26/10/1914",
				title: "war declared",
				transcript: "Assorted resources from the First World War",
				unlocked: true
			}, {
				username: "Dave",
				img: "images/event-dark.jpg",
				type: "events",
				date: "01/07/1915",
				title: "war declared",
				transcript: "Event from the First World War",
				unlocked: true
			},
			{
				username: "carol",
				img: "images/stories.png",
				type: "stories",
				date: "27/07/1915",
				title: "war declared",
				transcript: "Story from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/photo.png",
				type: "photos",
				date: "27/08/1915",
				title: "war declared",
				transcript: "Photograph from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/letter.png",
				type: "letters",
				date: "27/08/1915",
				title: "war declared",
				transcript: "Letter from the First World War",
				unlocked: true
			},
			{
				username: "Dave",
				img: "images/propaganda.png",
				type: "propaganda",
				date: "27/07/1915",
				title: "war declared",
				transcript: "Propaganda from the First World War",
				unlocked: false
			},
			{
				username: "carol",
				img: "images/news-dark.jpg",
				type: "newspapers",
				date: "27/07/1915",
				title: "war declared",
				transcript: "Newspaper from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/other-dark.jpg",
				type: "other",
				date: "27/08/1915",
				title: "war declared",
				transcript: "Assorted resources from the First World War",
				unlocked: true
			}, {
				username: "Dave",
				img: "images/event-dark.jpg",
				type: "events",
				date: "27/09/1915",
				title: "war declared",
				transcript: "Event from the First World War",
				unlocked: true
			},
			{
				username: "carol",
				img: "images/stories.png",
				type: "stories",
				date: "28/09/1915",
				title: "war declared",
				transcript: "Story from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/photo.png",
				type: "photos",
				date: "30/09/1915",
				title: "war declared",
				transcript: "Photograph from the First World War",
				unlocked: true
			},
			{
				username: "kerry",
				img: "images/letter.png",
				type: "letters",
				date: "10/10/1915",
				title: "war declared",
				transcript: "Letter from the First World War",
				unlocked: false
			},
			{
				username: "Dave",
				img: "images/propaganda.png",
				type: "propaganda",
				date: "12/10/1915",
				title: "war declared",
				transcript: "Propaganda from the First World War",
				unlocked: true
			},
			{
				username: "Carol",
				img: "images/news-dark.jpg",
				type: "newspapers",
				date: "22/10/1915",
				title: "war declared",
				transcript: "Newspaper from the First World War",
				unlocked: true
			},
			{
				username: "Kerry",
				img: "images/other-dark.jpg",
				type: "other",
				date: "26/10/1915",
				title: "war declared",
				transcript: "Assorted resources from the First World War",
				unlocked: true
			}
		]

		function init() {
			let temp = unlockedColNum;

			/*$.each(yearStatus, function (index, value) {		
			alert($('#'+ value.year).attr('contentNumUnlocked'));
				if (temp >0 || value.year == 1914){
					$('#'+ value.year).attr('unlocked', true);
					$('#'+ value.year).attr('contentNumUnlocked', 2);
					alert($('#'+ value.year).attr('contentNumUnlocked'));
				}	else {
					$('#'+ value.year).attr('unlocked', false);
				}
				
				temp-= value.contentNum;
			});*/

			let day, month, year;
			content = content.sort(function (a, b) {
				day = a.date.substring(0, 2);
				month = a.date.substring(3, 5);
				year = a.date.substring(6);
				a = new Date(year, month, day);

				day = b.date.substring(0, 2);
				month = b.date.substring(3, 5);
				year = b.date.substring(6);
				b = new Date(year, month, day);

				if (b > a) {
					return -1;
				} else if (b < a) {
					return 1;
				} else {
					return 0;
				}
			});

			let newContent = [];

			for (var i = 0; i < content.length; i++) {
				if (content[i].date.substring(6) == contentYear) {
					newContent.push(content[i]);
				}
			}

			$("#timelineItems").empty();
			$("#scrubber").empty();

			let widthPercent = 23;
			let heightPercent;
			let color = "";
			let colNum = 0;
			let boxHeight = 100 / filters.length;
			let boxWidth = 100 / (newContent.length / (filters.length + (7 - filters.length)));
			let count = 0;

			$.each(newContent, function (index, value) {
				let contentNumber = $('#' + contentYear).attr('contentNumUnlocked');
				let start = 0;
				if (contentYear == 1914) {
					start = 0;
				} else if (contentYear == 1915) {

					start = 14;
				} else if (contentYear == 1916) {
					start = 28;
				} else if (contentYear == 1917) {
					start = 28;
				} else if (contentYear == 1918) {
					start = 28;
				}

				if (contentNumber >= colNum) {
					if (index % (filters.length + (7 - filters.length)) == 0) {
						colNum++;
						$("#scrubber").append('<div id="sc' + colNum + '" class="scrubberCol"  style=" width:' + boxWidth + '%">');
					}

					if (value.type == 'events') {
						color = "blue";
					} else if (value.type == 'letters') {
						color = "yellow";
					} else if (value.type == 'propaganda') {
						color = "red";
					} else if (value.type == 'other') {
						color = "grey";
					} else if (value.type == 'newspapers') {
						color = "white";
					} else if (value.type == 'stories') {
						color = "black";
					} else if (value.type == 'photos') {
						color = "green";
					}

					if ($.inArray(value.type, filters) != -1) {

						if (count % 2 == 0) {
							heightPercent = 52;
						} else {
							heightPercent = 10;
						}
						count++
						let n = index + start;
						$('#sc' + colNum).append('<a href="#' + n + '"><div class="box" style="background-color:' + color + '; height:' + boxHeight + 'px; width:' + 100 + '%"></div></a>');

						addToList(n, value, widthPercent, heightPercent);
						widthPercent += 2.5;
					}
				}
			});

			$(".timeline__content").click(function () {
				let index = this.id.substring(1);
				toggleModal();

				if (content[index].unlocked == true) {
					mHeader.append("'" + content[index].title + " " + content[index].unlocked + "' <br>transcribed by " + content[index].username);
					$('#modalImage').append('<img width=400px src="' + content[this.id.substring(1)].img + '">');
					mTranscript.append('<p>' + content[index].transcript + '</p>');
				} else {
					mHeader.append("Transcribe document");
					$('#modalImage').append('<img width=400px src="' + content[this.id.substring(1)].img + '">');
					mTranscript.append('<textarea id="ta" rows="4" cols="50"></textarea><button id="submit">Submit</button>');
					$("#submit").click(function () {
						let obj = { username: "Karen", img: "./images/newspaper.png", type: "newspaper", date: "2/10/1916", title: $("#ha").val(), transcript: $("#ta").val() };
						var num = $('#' + contentYear).attr('contentNumUnlocked');
						var idNum = contentYear;
						idNum++;
						num++;

						if (num > $('#' + contentYear).attr('contentNum')) {
							$('#' + idNum).attr('unlocked', true);
							$('#' + idNum).attr('contentNumUnlocked', 1);
						} else {
							$('#' + contentYear).attr('contentNumUnlocked', num);
						}


						content.push(obj);
						unlockedColNum++;
						content[index].transcript = $('#ta').val();
						content[index].unlocked = true;
						toggleModal();
						init();
					});
				}
				modal.css("position", "sticky");
			});
		}

		function toggleModal() {
			modal.css("position", "fixed");
			modal.toggleClass("show-modal");
			$('#modalHeader').empty();
			$('#modalImage').empty();
			$('#modalTranscript').empty();
		}

		function addToList(index, value, width, height) {
			let t = "<span>" + value.type + "</span>";
			let span = "<span>'" + value.title + "'</span><span>Transcribed by " + value.username + "</span><span>" + value.date + "</span>";
			if (value.unlocked == true) {
				$("#timelineItems").append("<div id='I" + index + "' class='float depth10 timeline__content' style='left: " + width + "%; top: " + height +
					"%; background-image: url(" + value.img + ")'><a name='" + index + "'></a></div>");
			} else {
				$("#timelineItems").append("<div id='I" + index + "' class='float depth10 timeline__content' style='left: " + width + "%; top: " + height +
					"%;'><a name='" + index + "'></a></div>");
			}
			$("#I" + index).append(t);
			$("#I" + index).append(span);
		}

		$("#addStory").click(function () {
			toggleModal();
			mHeader.append("Add story");
			$('#modalImage').append('<p>Soldier search<input type="text"></p><p>Private John Anthony Hopkins</p><img width=100px src="./images/family.png">');
			mTranscript.append('<textarea id="ta" rows="4" cols="50"></textarea><button id="submit">Submit</button>');
			$("#submit").click(function () {
				let obj = { username: "Karen", img: "./images/family.png", type: "story", date: "2/10/1916", title: "story", transcript: $("#ta").val() };
				content.push(obj);
				toggleModal();
				init();
			});
		});

		$("#addTranscript").click(function () {
			toggleModal();
			mHeader.append("Transcribe document");
			$('#modalImage').append('<img width=400px src="./images/newspaper.png">');
			mTranscript.append('<textarea id="ha" rows="1" cols="50"></textarea><textarea id="ta" rows="4" cols="50"></textarea><button id="submit">Submit</button>');
			$("#submit").click(function () {
				let obj = { username: "Karen", img: "./images/newspaper.png", type: "newspaper", date: "2/10/1916", title: $("#ha").val(), transcript: $("#ta").val() };
				content.push(obj);
				toggleModal();
				init();
			});
		});

		init();

		$("#circle-button").click(function () {
			var buttons = $("#buttons");

			if (buttonsShow == true) {
				buttons.css('display', 'none');
			} else {
				buttons.css('display', 'block');
			}
			buttonsShow = !buttonsShow;
		});

		$('.check').click(function () {
			let i = filters.indexOf(this.id);

			if ($.inArray(this.id, filters) != -1) {
				filters.splice(i, 1);
			} else {
				filters.push(this.id);
			}
			init();
		});

		$('.year').click(function () {
			if ($('#' + this.id).attr("unlocked") == 'true') {
				unlockedColNum = 1;
				contentYear = this.id;
				$("#yearText").text(contentYear);
				init();
			}
		});

		closeButton.click(toggleModal);

	</script>
</body>

</html>